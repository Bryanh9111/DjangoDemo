<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Table with ag-Grid Community</title>

    {% load static %}
    
    <!-- Local ag-Grid CSS -->
    <link rel="stylesheet" href="{% static 'ag-grid/styles/ag-grid.css' %}">
    <link rel="stylesheet" href="{% static 'ag-grid/styles/ag-theme-alpine.css' %}">
    
    <style>
        /* Define grid size */
        .ag-theme-alpine {
            height: 500px;
            width: 100%;
        }

        .user-info {
            position: absolute;
            top: 10px;
            right: 20px;
            text-align: right;
            font-size: 14px;
            color: #333;
        }
    </style>
</head>
<body>
    <!-- User Info Section -->
    <div class="user-info">
        <strong>{{ user_info.displayName }}</strong><br>
        <span>{{ user_info.jobTitle }}</span>
    </div>

    <!-- Hidden element to store the data in JSON format -->
    {{ data|json_script:"data-json" }}

    <!-- ag-Grid container -->
    <div id="myGrid" class="ag-theme-alpine"></div>

    <!-- Local ag-Grid JS -->
    <script src="{% static 'ag-grid/ag-grid-community.min.js' %}"></script>
    
    <script>
        // Retrieve the row data from the hidden element
        var rowData = JSON.parse(document.getElementById('data-json').textContent);

        // Define columns for ag-Grid
        var columnDefs = [
            { headerName: "H1", field: "H1", rowGroup: true },
            { headerName: "H2", field: "H2" },
            { headerName: "H3", field: "H3" },
            { headerName: "H4", field: "H4", columnGroupShow: 'open' },
            { headerName: "H5", field: "H5" },
            { headerName: "H6", field: "H6" },
            { headerName: "Processed", field: "processed_flag" }
        ];

        var gridOptions = {
            columnDefs: columnDefs,
            rowData: rowData,
            groupDisplayType: 'groupRows',
            defaultColDef: {
                sortable: true,
                filter: true
            }
        };

        // Initialize ag-Grid
        document.addEventListener('DOMContentLoaded', function() {
            var eGridDiv = document.querySelector('#myGrid');
            new agGrid.Grid(eGridDiv, gridOptions);
        });
    </script>
</body>
</html>
